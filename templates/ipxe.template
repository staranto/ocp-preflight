#!ipxe

# Generated with ocp-preflight (https://github.com/staranto/ocp-preflight)
#   On:  {{ template_run_date }}
#   By:  {{ lookup('pipe', 'whoami') }} @ {{ lookup('pipe', 'hostname') }}
#   Git: {{ lookup('pipe', 'git log -n 1 | head -n 1') }}

set www  {{ hostvars[groups['http'][0]].ip }}
set ip   {{ hostvars[item].ip }}
set host {{ item }}
set dns  {{ hostvars[groups['dns'][0]].ip }}

kernel http://${www}/rhcos/kernel rd.neednet=1 initrd=http://${www}/rhcos/initramfs console=tty0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url=http://${www}/rhcos/raw coreos.inst.ignition_url=http://${www}/master.ign ip=${ip}::192.168.86.1:255.255.255.0:${host}:ens18:none nameserver=${dns}

initrd http://${www}/rhcos/initramfs 

boot
